<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tool AI Crawler</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 600px;
      width: 100%;
      text-align: center;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    .form-group {
      margin-bottom: 25px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    input[type="url"] {
      width: 100%;
      padding: 15px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      outline: none;
    }

    input[type="url"]:focus {
      border-color: #667eea;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      width: 100%;
      margin-top: 10px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .download-btn {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      margin-top: 15px;
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    }

    .download-section {
      margin-top: 15px;
    }

    .countdown {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-weight: 600;
    }

    #countdown {
      font-weight: bold;
      color: #e74c3c;
    }

    .loading {
      display: none;
      margin: 20px 0;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 10px;
      display: none;
    }

    .result.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .examples {
      margin-top: 30px;
      text-align: left;
    }

    .examples h3 {
      color: #333;
      margin-bottom: 15px;
    }

    .example-urls {
      display: grid;
      gap: 10px;
    }

    .example-url {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      color: #495057;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .example-url:hover {
      background: #e9ecef;
    }

    .status {
      margin-top: 15px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="logo">üï∑Ô∏è Tool AI Crawler</div>
    <div class="subtitle">Extract tool information from Toolify.ai categories</div>

    <form id="crawlForm">
      <div class="form-group">
        <label for="targetUrl">Category URL:</label>
        <input type="url" id="targetUrl" name="targetUrl"
          placeholder="https://www.toolify.ai/category/ai-background-remover" required>
      </div>

      <button type="submit" class="btn" id="crawlBtn">
        üöÄ Start Crawling
      </button>
    </form>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>üîÑ Crawling in progress... This may take a few minutes.</div>
    </div>

    <div class="result" id="result"></div>

    <div class="examples">
      <h3>üìã Popular Categories:</h3>
      <div class="example-urls">
        <div class="example-url" onclick="setUrl('https://www.toolify.ai/category/ai-background-remover')">
          AI Background Remover
        </div>
        <div class="example-url" onclick="setUrl('https://www.toolify.ai/category/resume-ai')">
          Resume AI
        </div>
        <div class="example-url" onclick="setUrl('https://www.toolify.ai/category/prompt-engineering')">
          Prompt Engineering
        </div>
        <div class="example-url" onclick="setUrl('https://www.toolify.ai/category/ai-image-generator')">
          AI Image Generator
        </div>
        <div class="example-url" onclick="setUrl('https://www.toolify.ai/category/ai-music-generator')">
          AI Music Generator
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('crawlForm');
    const targetUrlInput = document.getElementById('targetUrl');
    const crawlBtn = document.getElementById('crawlBtn');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');

    function setUrl(url) {
      targetUrlInput.value = url;
    }

    function showLoading() {
      loading.style.display = 'block';
      result.style.display = 'none';
      crawlBtn.disabled = true;
      crawlBtn.textContent = '‚è≥ Crawling...';
    }

    function hideLoading() {
      loading.style.display = 'none';
      crawlBtn.disabled = false;
      crawlBtn.textContent = 'üöÄ Start Crawling';
    }

    function showResult(success, message, filename = null) {
      result.style.display = 'block';
      result.className = `result ${success ? 'success' : 'error'}`;

      if (success && filename) {
        result.innerHTML = message + `
                    <br><br>
                    <div class="download-section">
                        <div class="countdown">‚è∞ File will be auto-deleted in <span id="countdown">2:00</span></div>
                        <button onclick="downloadFile('${filename}')" class="btn download-btn">
                            üì• Download Excel File
                        </button>
                    </div>
                `;

        // Start countdown timer
        startCountdown(filename);
      } else {
        result.innerHTML = message;
      }
    }

    function startCountdown(filename) {
      let timeLeft = 120; // 2 minutes in seconds

      const countdownElement = document.getElementById('countdown');
      const countdownInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        timeLeft--;

        if (timeLeft < 0) {
          clearInterval(countdownInterval);
          // Show message that file was auto-deleted
          showResult(true, `
                        ‚è∞ <strong>File auto-deleted!</strong><br><br>
                        üìÅ The Excel file was automatically deleted after 2 minutes.<br>
                        üîÑ Please run the crawler again to generate a new file.
                    `);
        }
      }, 1000);
    }

    function downloadFile(filename) {
      // Clear any existing countdown
      const countdownElement = document.getElementById('countdown');
      if (countdownElement) {
        countdownElement.parentElement.parentElement.remove();
      }

      const link = document.createElement('a');
      link.href = `/download/${filename}`;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      // Show success message
      setTimeout(() => {
        showResult(true, `
                    ‚úÖ <strong>Download completed!</strong><br><br>
                    üìÅ The Excel file has been downloaded to your computer.<br>
                    üóëÔ∏è The file has been automatically deleted from the server.
                `);
      }, 1000);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const targetUrl = targetUrlInput.value.trim();

      if (!targetUrl) {
        showResult(false, '‚ùå Please enter a valid URL');
        return;
      }

      if (!targetUrl.includes('toolify.ai/category/')) {
        showResult(false, '‚ùå Please enter a valid Toolify.ai category URL');
        return;
      }

      showLoading();

      try {
        const response = await fetch('/crawl', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ targetUrl })
        });

        const data = await response.json();

        if (data.success) {
          showResult(true, `
                        ‚úÖ <strong>Crawling completed successfully!</strong><br><br>
                        üìä <strong>Results:</strong><br>
                        ‚Ä¢ Total tools found: ${data.totalProducts}<br>
                        ‚Ä¢ Category: ${data.categoryName}<br>
                        ‚Ä¢ File ready: ${data.filename}<br><br>
                        üíæ Click the download button below to get your Excel file.
                    `, data.filename);
        } else {
          showResult(false, `‚ùå Error: ${data.error}`);
        }
      } catch (error) {
        showResult(false, '‚ùå Network error. Please try again.');
        console.error('Error:', error);
      } finally {
        hideLoading();
      }
    });
  </script>
</body>

</html>